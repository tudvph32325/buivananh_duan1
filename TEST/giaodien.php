<?php require "./inc/header.php";
require "./inc/link.php"; ?>


<div class="container">
    <div class="row ">
        <div class="col-lg-9 col-md-12 px-4">
            ///

            <?php

            echo '<div class="card mb-4 border-0 shadow">';
            echo '<div class="row g-0 align-items-center">';

            echo '<div class="col-md-5 ">';
            echo '<img class="img-fluid roundeds">';
            echo '</div>';

            echo '<div class="col-md-5 ">';
            echo '<h5 class="mb-3">Xuất tên phòng</h5>';
            echo '<h6 class="mb-3">Loại Phòng : xuat loai phong</h6>';

            echo '<div class="features mb-4">';
            echo '<h6 class="mb-1">ALL Nội Thất</h6>';
            echo ' <span class="badge rounded-pill bg-light text-dark texr-wrap">2 Giường</span>';
            echo ' <span class="badge rounded-pill bg-light text-dark texr-wrap">1 cửa xổ </span>';
            echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">1 Ban công</span>';
            echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">3 Ghế</span>';
            echo '</div>';

            echo '<div class="features2 mb-4">';
            echo ' <h6 class="mb-1">ALL Dịch Vụ</h6>';
            echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">Xuat dich vu</span>';

            echo '</div>';

            echo '<div class="songuoi mb-4">';
            echo '<h6 class="mb-1">ALL Số người</h6>';
            echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">4 người lớn</span>';
            echo ' <span class="badge rounded-pill bg-light text-dark texr-wrap">2 trẻ em</span>';
            echo ' </div>';
            echo '<div class="songuoi mb-4">';
            echo '<h6 class="mb-1">Mô tả:</h6>';
            echo '<p>xuat mo ta </p>';

            echo '</div>';
            echo ' <h6 class="mb-4 text-center">xuât gía /đêm</h6>';
            echo '<a href="#" name="booking" class="btn btn-sm w-100 text-white custom-bg shadow-none mb-2">Đặt Ngay</a>';
            echo '<a href="#" name="chitiet" class="btn btn-sm w-100 btn-outline-dark shadow-none mb-2">Xem chi tiết</a>';

            echo '</div>';
            echo '</div>';
            echo '</div>';


            ?>
            echo <div class="card mb-4 border-0 shadow">';
                <div class="row g-0 align-items-center">

                    <div class="col-md-5 ">
                        <img class="img-fluid roundeds"> // xuat ảnh
                    </div>

                    <div class="col-md-5 ">
                        <h5 class="mb-3">Xuất tên phòng</h5>
                        <h6 class="mb-3">Loại Phòng : xuat loai phong</h6>

                        <div class="features mb-4">
                            <h6 class="mb-1">ALL Nội Thất</h6>
                            <span class="badge rounded-pill bg-light text-dark texr-wrap">2 Giường</span>
                            <span class="badge rounded-pill bg-light text-dark texr-wrap">1 cửa xổ </span>
                            <span class="badge rounded-pill bg-light text-dark texr-wrap">1 Ban công</span>
                            <span class="badge rounded-pill bg-light text-dark texr-wrap">3 Ghế</span>
                        </div>

                        <div class="features2 mb-4">
                            <h6 class="mb-1">ALL Dịch Vụ</h6>
                            <span class="badge rounded-pill bg-light text-dark texr-wrap">Xuat dich vu</span>

                        </div>

                        <div class="songuoi mb-4">
                            <h6 class="mb-1">ALL Số người</h6>
                            <span class="badge rounded-pill bg-light text-dark texr-wrap">4 người lớn</span>
                            <span class="badge rounded-pill bg-light text-dark texr-wrap">2 trẻ em</span>
                        </div>
                        <div class="songuoi mb-4">
                            <h6 class="mb-1">Mô tả:</h6>
                            <p>xuat mo ta </p>

                        </div>
                        <h6 class="mb-4 text-center">xuât gía /đêm</h6>
                        <a href="#" name="booking" class="btn btn-sm w-100 text-white custom-bg shadow-none mb-2">Đặt Ngay</a>
                        <a href="#" name="chitiet" class="btn btn-sm w-100 btn-outline-dark shadow-none mb-2">Xem chi tiết</a>

                    </div>
                </div>
            </div>




            ////
        </div>
    </div>
</div>

<?php


//https://pixabay.com/vi/images/search/hotel/




?>

<div class="col-lg-4 col-md-6 my-3">
    <div class="card border-0 shadow" style="max-width: 350px; margin: auto;">
        <img src="xuat anh" class="card-img-top">

        <!-- phong -->
        <div class="card-body">
            <h5>Xuất tên phòng </h5>
            <h6>Xuất loại phong</h6>
            <h6 class="mb-4">Xuất giá phòng / đêm </h6>
            echo '<div class="features mb-4">';
                echo '<h6 class="mb-1">Nội Thất :</h6>';
                echo ' <span class="badge rounded-pill bg-light text-dark texr-wrap"> Giường</span>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">Điện Thoại Bàn</span>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">Điều Hòa</span>';
                echo ' <span class="badge rounded-pill bg-light text-dark texr-wrap">cửa xổ </span>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">1 Phòng Tắm</span>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">1 Vệ Sinh</span>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">Ghế</span>';
                echo '</div>';

            <div class="features mb-4">
                <h6 class="mb-1">All Dịch vụ</h6>
                <span class="badge rounded-pill bg-light text-dark texr-wrap">xuat dich vu</span>

            </div>

            <div class="songuoi mb-4">
                <h6 class="mb-1">Só người có thể chứa</h6>
                <span class="badge rounded-pill bg-light text-dark texr-wrap">4 người lớn</span>
                <span class="badge rounded-pill bg-light text-dark texr-wrap">2 trẻ em </span>
            </div>

            <div class="songuoi mb-4">
                <h6 class="mb-1">Mô tả</h6>
                <p>Xuất mo tả</p>
            </div>


            <div class="rating mb-4">
                <h6 class="mb-1">Đánh giá</h6>
                <span class="badge rounded-pill bg-light ">
                    <i class="bi bi-star-fill text-warning"></i>
                    <i class="bi bi-star-fill text-warning"></i>
                    <i class="bi bi-star-fill text-warning"></i>
                    <i class="bi bi-star-fill text-warning"></i>
                    <i class="bi bi-star-fill text-warning"></i>
                </span>
            </div>

            <div class="d-flex justify-content-evenly mb-2">
                <a href="#" class="btn btn-sm text-white custom-bg shadow-none">Đặt Ngay</a>
                <a href="#" class="btn btn-sm btn-outline-dark shadow-none">Xem chi tiết</a>
            </div>
        </div>
        <!--end phong-->

    </div>
</div>


///////////

while ($row = mysqli_fetch_assoc($phongResult)) {
                echo '<div class="col-lg-4 col-md-6 my-3">';
                echo '<div class="card border-0 shadow" style="max-width: 350px; margin: auto;">';
                echo '<img src="' . $row['image'] . '" style=" width: 350px; height: 300px;" alt="Ảnh đang lỗi fix sau" class="card-img-top">';
                echo ' <div class="card-body">';
                echo ' <h5> Tên Phòng :' . $row['name'] . ' </h5>';
                echo ' <h6>Tên loại phòng :' . $row['ten_loai_phong'] . '</h6>';
                echo ' <h6 class="mb-4">Giá phòng :' . number_format($row['gia'], 0, '.', ',') . ' VNĐ / Đêm </h6>';
                echo '<div class="features mb-4">';
                echo '<h6 class="mb-1">Nội Thất :</h6>';
                echo ' <span class="badge rounded-pill bg-light text-dark texr-wrap"> Giường</span>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">Điện Thoại Bàn</span>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">Điều Hòa</span>';
                echo ' <span class="badge rounded-pill bg-light text-dark texr-wrap">cửa xổ </span>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">1 Phòng Tắm</span>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">1 Vệ Sinh</span>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">Ghế</span>';
                echo '</div>';
                echo ' <div class="features mb-4">';
                echo '  <h6 class="mb-1">Dịch vụ</h6>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">' . $row['dichvu'] . '</span>';
                echo ' </div>';
                echo ' <div class="songuoi mb-4">';
                echo '  <h6 class="mb-1">Số người có thể chứa</h6>';
                echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">2 người lớn</span>';
                echo ' <span class="badge rounded-pill bg-light text-dark texr-wrap">2 trẻ em </span>';
                echo ' </div>';
                echo ' <div class="rating mb-4">';
                echo ' <h6 class="mb-1">Đánh giá</h6>';
                echo ' <span class="badge rounded-pill bg-light ">';
                echo '  <i class="bi bi-star-fill text-warning"></i>';
                echo '  <i class="bi bi-star-fill text-warning"></i>';
                echo ' <i class="bi bi-star-fill text-warning"></i>';
                echo '  <i class="bi bi-star-fill text-warning"></i>';
                echo ' <i class="bi bi-star-fill text-warning"></i>';
                echo ' </span>';
                echo '</div>';

                echo ' <div class="rating mb-4">';
                echo ' <h6 class="mb-1">' . trangThaiPhong($row['trangthai']) . '</h6>';
                echo '</div>';
                echo '  <div class="d-flex justify-content-evenly mb-2">';

                // kiểm tra khi đã đăng nhập hiển thị nút bình thừơng 
                echo '<?php if ($isLoggedIn): ?>';

                echo ' <a href="booking.php" class="btn btn-sm text-white custom-bg shadow-none" >Đặt Ngay</a>';
                // nếu chưa đăng nhập khi ấn nút sẽ hiển thị thông báo yêu cầu đăng nhập
                echo ' <?php else: ?>';

                echo '<a href="#" onclick="alert(\'Bạn cần đăng nhập để thực hiện đặt phòng\');" class="btn btn-sm text-white custom-bg shadow-none">Đặt Ngay</a>';
                echo ' <?php endif; ?>';




                echo ' <a href="phong_chitiet.php?id=' . $row['id'] . '" class="btn btn-sm btn-outline-dark shadow-none">Xem chi tiết</a>';
                echo '</div>';
                echo '</div>';
                echo ' </div>';
                echo '</div>';
            }


            <?php

//phương thức thanh toán 
$phuongThucThanhToan  = [
    'thanh_toan_khi_tra_phong' => 'Thanh toán khi trả Phòng',
    // 'thanh_toan_truc_tuyen' => 'Thanh toán trực tuyến',
];

$phongFrom = null;
// xuat thông tin phòng ra cho người dùng book theo id 
if (isset($_GET['id'])) {
    // khi người dùng kích vào nút đặt ngay sẽ lấy thông tin phòng phòng đó theo id 
    $phong_id = $_GET['id'];
    // 
    // truy vấn lấy thông phòng dựa theo id đó 
    // truy vấn 
    $phongQuery = "SELECT * FROM phong WHERE id = $phong_id";
    // trả về kết quả với biến tao chứa lưu kết quả 
    $phongResult = mysqli_query($conn, $phongQuery);
    // nếu có truy vấn đc thông tin thì vào phongResult thì khai báo 1 biến mới dùng mysqli_fetch_assoc lấy dữ liêụ từ mảng kết hợp 
    // check kiểm tra 
    if ($phongResult && mysqli_num_rows($phongResult) > 0) {
        $phongFrom = mysqli_fetch_assoc($phongResult);
    } else {
        echo "ko tim thay thong tin phong";
    }
}

// thêm du lieu dat phong vao vào csdl 
if (isset($_POST['datphong'])) {
    // lấy thông tin từ from 

    $NgayBatDau = new DateTime(($_POST['NgayBatDau']));
    $NgayKetThuc = new DateTime(($_POST['NgayKetThuc']));
    $ghichu = $_POST['ghichu'];
    $phuongthuc = $_POST['phuongthuc'];
    $trangthai = 0;
    // trạng thái xu li sau 
    // id phong truyền qua url id
    $phong_id = isset($_POST['phong_id']) ? $_POST['phong_id'] : null; // Kiểm tra xem 'phong_id' có tồn tại không

    // xu li dinh dang checkin checkout de xu dung trong mysqli_stmt_bind_param
    $FormatNgayBatDau = $NgayBatDau->format('Y-m-d');
    $FormatNgayKetThuc = $NgayKetThuc->format('Y-m-d');

    // xu li tinh tong tien theo thoi gian checkin check out
    // truy van lay tien phong theo id 
    $Query = "SELECT gia FROM phong WHERE id = ?";
    // mysqli_prepare chuẩn bị câu lệnh trước khi thực thi trả về đôi tượng và gán giá trị vào mysqli_stmt_bind_param
    $stmt = mysqli_prepare($conn, $Query);
    mysqli_stmt_bind_param($stmt, "i", $phong_id);


    // chạy câu lênh sql dc chuẩn bị trước đo 
    mysqli_stmt_execute($stmt);
    //khởi tạo biến  lấy kết trả về từ câu lệnh  mysqli_prepare chứa các kết quả
    $result = mysqli_stmt_get_result($stmt);
    // khởi tạo 1 biến để lấy 1 hàng kết quả từ 1 tập kết quả trả về trước đó
    $row = mysqli_fetch_assoc($result);
    // tạo biến giá phòng để lưu gía phòng đã lấy đc 
    $giaPhong = isset($row['gia']) ? $row['gia'] : 0; // Sử dụng giá trị mặc định nếu không tìm thấy


    // thực hiện tính tổng tiền theo checkin checkout 
    // tính toán số ngày
    //diff tính khoảng cach giữa 2 đôi tượng và truy xuất số ngày giữa 2 đôi tượng ngaybatdau va ngatketthuc
    $soNgay = $NgayBatDau->diff($NgayKetThuc)->days;
    // tính tổng tiền khi chọn ngày checkin checkout 
    $tongTien = $giaPhong  * $soNgay;

    // xửa lí ngày checkin checkout vào csdl 
    $FormatNgayBatDau = $NgayBatDau->format('Y-m-d');
    $FormatNgayKetThuc = $NgayKetThuc->format('Y-m-d');

    // thực hiện truy vấn 
    $datPhongQuery = "INSERT INTO dat_phong (NgayBatDau, NgayKetThuc, tongTien, ghichu, trangthai, phuongthuc) VALUES (?, ?, ?, ?, ?, ?)";

    // chuan bi cau lenh truoc khi thuc thi trang lo hong bao mat
    $stmt = mysqli_prepare($conn, $datPhongQuery);
    // mysqli_stmt_bind_param() là một hàm  để gán dữ liệu đầu vào cho các đánh dấu tham số trong một câu lệnh SQL đã được chuẩn bị bằng mysqli_prepare().Tham số bind là địa chỉ của một mảng các cấu trúc


    mysqli_stmt_bind_param($stmt, "ssisis", $FormatNgayBatDau, $FormatNgayKetThuc, $tongTien, $ghichu, $trangthai, $phuongthuc);

    // chay cau lenh 
    mysqli_stmt_execute($stmt);
    // kiem tra tra ve thong bao // mysqli_stmt_affected_rows co tac dung tra ve so luong hang bi anh huong boi sql khi cau lenh do la delete update insert neu > 0 tuc da thanh cong
    if (mysqli_stmt_affected_rows($stmt) > 0) {
        echo "<script>alert('Đặt phòng thành công. Đợi xác nhận từ quản trị viên.');</script>";
    } else {
        echo "that bai !!!";
    }

    // giai phong dong truy van 
    mysqli_stmt_close($stmt);
}


?>



echo '<div class="row g-0 align-items-center">';
                            echo '<div class="col-md-5 ">';
                            echo '<img class="img-fluid rounded"  src="' . $row['image'] . '" alt="Ảnh lỗi">';
                            echo '</div>';
                            echo '<div class="col-md-5 ">';
                            echo '<h5 class="mb-3">Tên Phòng :' . $row['name'] . '</h5>';
                            echo '<h6 class="mb-3"> Loại Phòng : ' . $row['ten_loai_phong'] . '</h6>';
                            echo '<div class="features mb-4">';
                            echo '<h6 class="mb-1">Nội Thất :</h6>';
                            echo ' <span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-bed"></i> Giường</span>';
                            echo '<span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-telephone"></i>Điện Thoại Bàn</span>';
                            echo '<span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-snow"></i>Điều Hòa</span>';
                            echo ' <span class="badge rounded-pill bg-light text-dark texr-wrap"> <i class="bi bi-door-open"></i>cửa xổ </span>';
                            echo '<span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-bath"></i> 1 Phòng Tắm</span>';
                            echo '<span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-house-door"></i>1 Vệ Sinh</span>';
                            echo '<span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-chair"></i>Ghế</span>';
                            echo '</div>';
                            echo '<div class="features2 mb-4">';
                            echo ' <h6 class="mb-1">Dịch Vụ :</h6>';
                            echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">' . $row['dichvu'] . '</span>';
                            echo '</div>';
                            echo '<div class="songuoi mb-4">';
                            echo '<h6 class="mb-1">Số người :</h6>';
                            echo '<span class="badge rounded-pill bg-light text-dark texr-wrap">2 người lớn</span>';
                            echo ' <span class="badge rounded-pill bg-light text-dark texr-wrap">2 trẻ em</span>';
                            echo ' <div class="features2 mb-4">';
                            echo ' <h6 class="mb-1">Chất lượng</h6>';
                            echo ' <span class="badge rounded-pill bg-light ">';
                            echo '  <i class="bi bi-star-fill text-warning"></i>';
                            echo '  <i class="bi bi-star-fill text-warning"></i>';
                            echo ' <i class="bi bi-star-fill text-warning"></i>';
                            echo '  <i class="bi bi-star-fill text-warning"></i>';

                            echo ' </span>';
                            echo '</div>';
                            echo '<div class="row">';
                            echo '<div class="col-md-6 text-center">';
                            echo '<h5 class="mb-4">' . number_format($row['gia'], 0, '.', ',') . ' VND/Đêm</h5>';
                            echo '</div>';
                            echo '<div class="col-md-6 text-center">';
                            echo '<h6 class="mb-4">' . trangThaiPhong($row['trangthai']) . '</h6>';
                            echo '</div>';
                            echo '</div>';
                            echo '<a href="#" name="booking" class="btn btn-sm w-100 text-white custom-bg shadow-none mb-2">Đặt Ngay</a>';
                            echo '<a href="phong_chitiet.php?id=' . $row['id'] . '" name="chitiet" class="btn btn-sm w-100 btn-outline-dark shadow-none mb-2">Xem chi tiết</a>';

                            echo '</div>';
                            echo '</div>';








                            <div class="container mt-4">
                    <div class="row">
                        <?php
                        require_once "/buivananh_duan1/admin/inc/db_config.php";
                     

                        ?>

                       
                            <div class="row g-0 align-items-center">
                                <div class="col-md-5 ">
                                    <img class="img-fluid rounded" src=" <?php echo $row['image']; ?> " alt="Ảnh lỗi">
                                </div>
                                <div class="col-md-5 ">
                                    <h5 class="mb-3">Tên Phòng : <?php echo $row['name']; ?> </h5>
                                    <h6 class="mb-3"> Loại Phòng : <?php echo $row['ten_loai_phong'] ?></h6>

                                    <div class="features mb-4">
                                        <h6 class="mb-1">Nội Thất :</h6>
                                        <span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-bed"></i> Giường</span>
                                        <span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-telephone"></i>Điện Thoại Bàn</span>
                                        <span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-snow"></i>Điều Hòa</span>
                                        <span class="badge rounded-pill bg-light text-dark texr-wrap"> <i class="bi bi-door-open"></i>cửa xổ </span>
                                        <span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-bath"></i> 1 Phòng Tắm</span>
                                        <span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-house-door"></i>1 Vệ Sinh</span>
                                        <span class="badge rounded-pill bg-light text-dark texr-wrap"><i class="bi bi-chair"></i>Ghế</span>
                                    </div>
                                    <div class="features2 mb-4">
                                        <h6 class="mb-1">Dịch Vụ :</h6>
                                        <span class="badge rounded-pill bg-light text-dark texr-wrap"> <?php echo $row['dichvu']; ?> </span>
                                    </div>
                                    <div class="songuoi mb-4">
                                        <h6 class="mb-1">Số người :</h6>
                                        <span class="badge rounded-pill bg-light text-dark texr-wrap">2 người lớn</span>
                                        <span class="badge rounded-pill bg-light text-dark texr-wrap">2 trẻ em</span>
                                        <div class="features2 mb-4">
                                            <h6 class="mb-1">Chất lượng</h6>
                                            <span class="badge rounded-pill bg-light ">
                                                <i class="bi bi-star-fill text-warning"></i>
                                                <i class="bi bi-star-fill text-warning"></i>
                                                <i class="bi bi-star-fill text-warning"></i>
                                                <i class="bi bi-star-fill text-warning"></i>

                                            </span>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 text-center">
                                                <h5 class="mb-4"><?php echo  number_format($row['gia'], 0, '.', ',') ?>  VND/Đêm</h5>
                                                
                                            </div>
                                            <div class="col-md-6 text-center">
                                                <h6 class="mb-4">  <?php echo trangThaiPhong($row['trangthai']); ?> </h6>

                                            </div>
                                        </div>

                                        <?php if ($isLoggedIn) : ?>
                                            <a href="booking.php?id=<?php echo $row['id']; ?>" class="btn btn-sm w-100 text-white custom-bg shadow-none mb-2">Đặt Ngay</a>

                                        <?php else : ?>

                                            <a href="#" onclick="alert('Bạn cần đăng nhập để thực hiện đặt phòng.');" class="btn btn-sm w-100 text-white custom-bg shadow-none mb-2">Đặt Ngay</a>

                                        <?php endif; ?>

                                        <a href="phong_chitiet.php?id=<?php echo $row['id']; ?>" name="chitiet" class="btn btn-sm w-100 btn-outline-dark shadow-none mb-2">Xem chi tiết</a>

                                    </div>
                                </div>
                            </div>
                     
                    </div>
                </div>